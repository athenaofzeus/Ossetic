{% extends 'base.html' %}
{% block title %}
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏
{% endblock %}
{% block content %}
    <div class="container mb-2">
        <div class="row gy-2 gy-lg-0 align-items-center justify-content-center">
            <div class="col-12 col-lg-4 col-xl-3 col-xxl-2">
                <div class="row g-1 g-lg-0 align-items-center justify-content-around">
                    <div class="container col align-self-center">
                        <div class="card card-body">
                            <div class="col-12 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="root" name="root" form="entry">
                                <label class="form-check-label" for="root" style="font-weight: bold;">
                                       <abbr style="text-decoration: none" data-bs-toggle="tooltip" title="–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç –∫–æ—Ä–Ω–µ–º?">–ù–µ –∫–æ—Ä–µ–Ω—å</abbr>
                                </label>
                            </div>
                            <div class="col-12 form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="hidden" name="hidden" form="entry">
                                <label class="form-check-label" for="hidden" style="font-weight: bold;">
                                       <abbr style="text-decoration: none" data-bs-toggle="tooltip" title="–î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Å—Ç–∞—Ç—å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø–∞—Ä—Å–µ—Ä–∞?">–°–∫—Ä—ã—Ç–∞</abbr>
                                </label>
                            </div>
                            <div class="col-12">
                                <div class="mb-2">
                                    <div class="form-floating">
                                        <select class="form-select" aria-label="–í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞" name="source" id="source" form="entry" required>
                                            <option value="1">—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è</option>
                                            <option value="2">–ö–∞—Ä–∞–º—à–æ–µ–≤</option>
                                            <option value="3">–°–æ–∫–æ–ª–æ–≤–∞</option>
                                            <option value="4">–ó–∞—Ä—É–±–∏–Ω</option>
                                        </select>
                                        <label for="source">–ò—Å—Ç–æ—á–Ω–∏–∫</label>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <select class="form-select" aria-label="–í—ã–±–æ—Ä —è–∑—ã–∫–∞" name="langs" form="entry" multiple required>
                                        {% for l in Languages.query.all() %}
                                            <option value="{{ l.lang_id }}">
                                                {{ l.lang }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-2">
                                    <input type="text"
                                           class="form-control"
                                           placeholder="–≥–ª–æ—Å—Å–∞"
                                           aria-label="–ì–ª–æ—Å—Å–∞"
                                           aria-describedby="–ì–ª–æ—Å—Å–∞"
                                           name="gloss"
                                           form="entry"
                                    >
                                </div>
                            </div>
                            <div class="col-12 align-items-center text-center">
                                <a class="text-primary h5"
                                   href="javascript:;"
                                   role="button"
                                   id="ls_unit"
                                   data-bs-toggle="dropdown"
                                   data-bs-auto-close="outside"
                                   aria-expanded="false"
                                   style="text-decoration-line: none; font-variant: small-caps"
                                >
                                    <span>–ü–æ–º–µ—Ç—ã</span>
                                </a>
                                <ul class="dropdown-menu overflow-auto p-1" aria-labelledby="labels_for_unit" style="height: 35vh">
                                    {% for l in Label_names.query.filter_by(type=1).order_by(Label_names.rank.asc(), Label_names.label.asc()).all() %}
                                        <li>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       value="{{ l.label_id }}"
                                                       full_name="{{ l.label }}"
                                                       id="l_u_{{ l.label_id }}"
                                                       name="l_u_{{ l.label_id }}"
                                                       form="entry"
                                                       onclick="addLabels('ls_unit', 'l_u_{{ l.label_id }}')"
                                                >
                                                <label class="form-check-label"
                                                       for="l_u_{{ l.label_id }}"
                                                       data-bs-toggle="tooltip"
                                                       title="{{ l.decode }}"
                                                       style="font-variant: small-caps"
                                                >
                                                    {{ Markup(l.label) }}
                                                </label>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-12 align-items-center text-center">
                                <a class="text-primary h5"
                                   href="javascript:;"
                                   role="button"
                                   data-bs-toggle="dropdown"
                                   data-bs-auto-close="outside"
                                   aria-expanded="false"
                                   style="text-decoration-line: none; font-variant: small-caps"
                                >
                                    <span>–ú–µ—Ä–µ–æ–ª–æ–≥–∏—è</span>
                                </a>
                                <ul class="dropdown-menu overflow-auto p-1" aria-labelledby="mereological_labels_for_unit" style="height: 35vh">
                                    {% for l in Label_names.query.filter_by(type=5).order_by(Label_names.rank.asc(), Label_names.label.asc()).all() %}
                                        <li>
                                            <div class="form-check">
                                                <input {% if (l.label_id,) in Mereological_labels.query.filter_by(unit_id=unit_id).with_entities(Mereological_labels.label_id).all() %}checked {% endif %}
                                                       class="form-check-input"
                                                       type="checkbox"
                                                       value="{{ l.label_id }}"
                                                       full_name="{{ l.label }}"
                                                       id="l_mer_u_{{ l.label_id }}"
                                                       name="l_mer_u_{{ l.label_id }}"
                                                       form="entry"
                                                >
                                                <label class="form-check-label"
                                                       for="l_mer_u_{{ l.label_id }}"
                                                       data-bs-toggle="tooltip"
                                                       title="{{ l.decode }}"
                                                       style="font-variant: small-caps"
                                                >
                                                    {{ Markup(l.label) }}
                                                </label>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-12 align-items-center text-center">
                                <a class="text-primary h5"
                                   href="javascript:;"
                                   role="button"
                                   data-bs-toggle="dropdown"
                                   data-bs-auto-close="outside"
                                   aria-expanded="false"
                                   style="text-decoration-line: none; font-variant: small-caps"
                                >
                                    <span>–¢–∞–∫—Å–æ–Ω–æ–º–∏—è</span>
                                </a>
                                <ul class="dropdown-menu overflow-auto p-1" aria-labelledby="taxonomic_labels_for_unit" style="height: 35vh">
                                    {% for l in Label_names.query.filter_by(type=3).order_by(Label_names.rank.asc(), Label_names.label.asc()).all() %}
                                        <li>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       value="{{ l.label_id }}"
                                                       full_name="{{ l.label }}"
                                                       id="l_t_u_{{ l.label_id }}"
                                                       name="l_t_u_{{ l.label_id }}"
                                                       form="entry"
                                                >
                                                <label class="form-check-label"
                                                       for="l_t_u_{{ l.label_id }}"
                                                       data-bs-toggle="tooltip"
                                                       title="{{ l.decode }}"
                                                       style="font-variant: small-caps"
                                                >
                                                    {{ Markup(l.label) }}
                                                </label>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-12 align-items-center text-center">
                                <a class="text-primary h5"
                                   href="javascript:;"
                                   role="button"
                                   data-bs-toggle="dropdown"
                                   data-bs-auto-close="outside"
                                   aria-expanded="false"
                                   style="text-decoration-line: none; font-variant: small-caps"
                                >
                                    <span>–¢–æ–ø–æ–ª–æ–≥–∏—è</span>
                                </a>
                                <ul class="dropdown-menu overflow-auto p-1" aria-labelledby="taxonomic_labels_for_unit" style="height: 35vh">
                                    {% for l in Label_names.query.filter_by(type=4).order_by(Label_names.rank.asc(), Label_names.label.asc()).all() %}
                                        <li>
                                            <div class="form-check">
                                                <input {% if (l.label_id,) in Topological_labels.query.filter_by(unit_id=unit_id).with_entities(Topological_labels.label_id).all() %}checked {% endif %}
                                                       class="form-check-input"
                                                       type="checkbox"
                                                       value="{{ l.label_id }}"
                                                       full_name="{{ l.label }}"
                                                       id="l_top_u_{{ l.label_id }}"
                                                       name="l_top_u_{{ l.label_id }}"
                                                       form="entry"
                                                >
                                                <label class="form-check-label"
                                                       for="l_top_u_{{ l.label_id }}"
                                                       data-bs-toggle="tooltip"
                                                       title="{{ l.decode }}"
                                                       style="font-variant: small-caps"
                                                >
                                                    {{ Markup(l.label) }}
                                                </label>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-12">
                                <label class="form-label h6" for="pictures_{{ unit_id }}">–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏</label>
                                <select class="form-select"
                                        multiple
                                        size="2"
                                        aria-label="–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∫ —Å—Ç–∞—Ç—å–µ"
                                        id="pictures_{{ unit_id }}"
                                        form="entry"
                                        name="pictures"
                                >
                                    {% for p in Pictures.query.all() %}
                                        <option value="{{ p.picture_id }}">{{ p.route }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-8 col-xl-9 col-xxl-10">
                <div class="container row">
                    <div class="col-12">
                        <label class="form-label h6" for="sem_{{ unit_id }}">–°–µ–º–∞–Ω—Ç–∏–∫–∞</label>
                        <textarea class="form-control overflow-auto"
                                  id="sem_{{ unit_id }}"
                                  name="sem_{{ unit_id }}"
                                  form="entry"
                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"
                                  style="max-height: 300px"
                        ></textarea>
                    </div>
                    <div class="col-12">
                        <div class="row align-items-center justify-content-between">
                            <div class="col-auto">
                                <label class="form-label h6" for="etym_{{ unit_id }}" style="cursor: pointer;">–≠—Ç–∏–º–æ–ª–æ–≥–∏—è</label>
                            </div>
                            <div class="col-auto">
                                <a class="link-secondary" onclick="print('—è–∑—ã–∫.¬†*—Å–ª–æ–≤–æ* ‚Äò–ø–µ—Ä–µ–≤–æ–¥‚Äô', 'etym_{{ unit_id }}')">–≤—Å—Ç–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω</a>
                            </div>
                        </div>
                        <textarea class="form-control overflow-auto"
                                  id="etym_{{ unit_id }}"
                                  name="etym_{{ unit_id }}"
                                  form="entry"
                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"
                                  style="max-height: 300px"
                        ></textarea>
                    </div>
                    <div class="col-12">
                        <label class="form-label h6" for="comments_{{ unit_id }}">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ä–µ–¥–∞–∫—Ü–∏–∏</label>
                        <textarea class="form-control overflow-auto"
                                  id="comments_{{ unit_id }}"
                                  name="comments_{{ unit_id }}"
                                  form="entry"
                                  placeholder="–ü–æ—è—Å–Ω–µ–Ω–∏–µ –≤–Ω–µ—Å—ë–Ω–Ω—ã—Ö –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏–π, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é, –ø—Ä–æ—á–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è"
                                  style="max-height: 300px"
                        ></textarea>
                    </div>
                    <div class="col-12">
                        <label class="form-label h6" for="notes_{{ unit_id }}">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-control overflow-auto"
                                  id="notes_{{ unit_id }}"
                                  name="notes_{{ unit_id }}"
                                  form="entry"
                                  placeholder="–í–∑—è—Ç—ã–µ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—å–∏"
                                  style="max-height: 100px"
                        ></textarea>
                    </div>
                    <div class="col-12 row g-2 align-items-center justify-content-between">
                        <div class="col-9 row align-items-center justify-content-between">
                            <div class="col-12 row g-1 align-items-center justify-content-between">
                                <div class="col-auto">
                                    <label class="form-label h6" for="links">–°—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∞—Ç—å–∏</label>
                                </div>
                                <div class="col-auto">
                                    <a class="link-secondary" onclick="new_link();" style="cursor: pointer;">–¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</a>
                                </div>
                            </div>
                            <div class="col-12 row align-items-center justify-content-between overflow-auto p-2" id="links" style="max-height: 35vh;">
                            </div>
                        </div>
                        <div class="col-3 align-items-center justify-content-center">
                            <div class="container align-self-center col">
                                <div class="container text-center mb-2">
                                    <button class="btn btn-sm btn-success" type="submit" form="entry">
                                        –î–æ–±–∞–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form name="entry" id="entry" method="post">
            <div class="container">
                <label for="full_text" class="form-label text-secondary">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏</label>
                <textarea id="full_text"
                          name="entry_text"
                          class="form-control overflow-auto"
                          style="max-height: 500px;"></textarea>
            </div>
            <div class="container row g-2 align-items-center justify-content-start my-2">
                <div class="col-auto form-label text-secondary">–ó–Ω–∞—á–µ–Ω–∏—è –∑–∞–≥–ª–∞–≤–Ω–æ–π –ª–µ–∫—Å–µ–º—ã</div>
                <div class="col-auto">
                    <button class="btn btn-sm btn-outline-success mb-2" onclick="addMeaning(unit_meanings, 'lex/{{ unit_id }}', new_unit=false)" type="button">
                        <span class="text-center">–î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</span>
                    </button>
                </div>
            </div>
            <div class="container table-responsive mb-2 overflow-auto" style="max-height: 400px;">
                <table class="table caption-top" id="unit_meanings">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 10%;">–†–∞–Ω–≥</th>
                            <th scope="col" style="width: 20%;">–ü–æ–º–µ—Ç—ã</th>
                            <th scope="col">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="container row g-2 align-items-center justify-content-start my-2">
                <div class="col-auto form-label text-secondary">–£—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∏ –∏–¥–∏–æ–º—ã</div>
                <div class="col-auto">
                    <button class="btn btn-sm btn-outline-success mb-2" onclick="addI_or_CV(unit_idioms, 'i')" type="button">
                        <span class="text-center">–î–æ–±–∞–≤–∏—Ç—å –∏–¥–∏–æ–º—É –∏–ª–∏ —É—Å—Ç–æ–π—á–∏–≤–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ</span>
                    </button>
                </div>
            </div>
            <div class="container table-responsive mb-2 overflow-auto" style="max-height: 400px;">
                <table class="table caption-top" id="unit_idioms">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 5vw;">‚Ññ</th>
                            <th scope="col" style="width: 20vw;">–§–æ—Ä–º—ã</th>
                            <th scope="col" style="width: 40vw;">–ó–Ω–∞—á–µ–Ω–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="container row g-2 align-items-center justify-content-start my-2">
                <div class="col-auto form-label text-secondary">–°–ª–æ–∂–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã</div>
                <div class="col-auto">
                    <button class="btn btn-sm btn-outline-success mb-2" onclick="addI_or_CV(unit_cvs, 'cv')" type="button">
                        <span class="text-center">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω—ã–π –≥–ª–∞–≥–æ–ª</span>
                    </button>
                </div>
            </div>
            <div class="container table-responsive overflow-auto" style="max-height: 400px;">
                <table class="table caption-top" id="unit_cvs">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 5vw;">‚Ññ</th>
                            <th scope="col" style="width: 20vw;">–§–æ—Ä–º—ã</th>
                            <th scope="col" style="width: 40vw;">–ó–Ω–∞—á–µ–Ω–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="container table-responsive">
                <table class="table caption-top" id="unit_forms">
                    <caption>–§–æ—Ä–º—ã –ª–µ–∫—Å–µ–º—ã</caption>
                    <thead>
                        <tr>
                            <th scope="col" style="width: 10%;">–ì–ª–æ—Å—Å–∞</th>
                            <th scope="col" style="width: 35%">–§–æ—Ä–º—ã</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div class="container mb-2 row align-items-center justify-content-end m-0 p-0">
                    <div class="col-auto">
                        <select class="form-select" aria-label="–í—ã–±–æ—Ä –≥–ª–æ—Å—Å—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—ã" onchange="if (this.value != 'none') {addNewForm(this.value, this.options[this.options.selectedIndex].getAttribute('gloss'), this.options[this.options.selectedIndex].text)};" id="select_new">
                            <option selected value="none">–í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–æ—Å—Å—É, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ–æ—Ä–º—É</option>
                            {% for g in Glosses.query.filter(Glosses.decode != '').all() %}
                                <option value="{{ g.gloss_id }}" gloss="{{ g.gloss }}">
                                    {{ g.decode }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script type='text/javascript'>
        for (var i = 0; i < document.getElementsByTagName('textarea').length; ++i) {
            autosize(document.getElementsByTagName('textarea')[i]);
        }

        $('#entry').submit(function(event) {
            if ((!$('abbr:contains("word")').length) && ((!$('abbr:contains("npst")').length))) {
                alert('–£–¥–æ—Å—Ç–æ–≤–µ—Ä—å—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ WORD –∏–ª–∏ NPST.')
                event.preventDefault();
                $('#select_new').focus();
            }
        });

        function addMeaning(table, unitID, new_unit) {
            if (table.rows.length > 0) {
                var current_num = table.rows.length;
            }
            else {
                var current_num = 1
            }
            var type = unitID.split('/')[0]
            var ID = unitID.split('/')[1]
            if (new_unit) {
                var prefix = 'new_'
            } else {
                var prefix = 'existent_'
            }
            $(table).find('tbody').append(
            `<tr>
                <th scope="row">
                <div class="row row-cols-2 align-items-center justify-content-center g-2">
                    <div class="col-auto">üÜï</div>
                    <div class="col-auto">${current_num}</div>
                    <div class="col-auto">
                        <input class="form-control"
                               type="number"
                               value="${current_num}"
                               id="${prefix}${type}_m_rank_${current_num}_${ID}"
                               name="${prefix}${type}_m_rank_${current_num}_${ID}"
                        >
                    </div>
                </div>
                </th>
                <td>
                    <div class="col-12 mb-2 row">
                        <div class="col-12 mb-1">
                            <a class="text-primary"
                               href="javascript:;"
                               role="button"
                               id="${prefix}_${type}_m_ls_${current_num}_${ID}"
                               data-bs-toggle="dropdown"
                               data-bs-auto-close="outside"
                               aria-expanded="false"
                               style="text-decoration-line: none; font-variant: small-caps"
                            >
                                 <span>–ü–æ–º–µ—Ç—ã</span>
                            </a>
                            <ul class="dropdown-menu p-1 overflow-auto" style="height: 35vh" aria-labelledby="dropdownMenuButton">
                                {% for l in Label_names.query.filter_by(type=1).order_by(Label_names.rank.asc(), Label_names.label.asc()).all() %}
                                    <li>
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                   type="checkbox"
                                                   value="{{ l.label_id }}"
                                                   full_name="{{ l.label }}"
                                                   id="${prefix}${type}_m_l_{{ l.label_id }}_${current_num}_${ID}"
                                                   name="${prefix}${type}_m_l_{{ l.label_id }}_${current_num}_${ID}"
                                                   onclick="addLabels('${prefix}_${type}_m_ls_${current_num}_${ID}', '${prefix}${type}_m_l_{{ l.label_id }}_${current_num}_${ID}')"
                                            >
                                            <label class="form-check-label"
                                                   for="${prefix}${type}_m_l_{{ l.label_id }}_${current_num}_${ID}"
                                                   data-bs-toggle="tooltip"
                                                   title="{{ l.decode }}"
                                                   style="font-variant: small-caps"
                                            >
                                                {{ Markup(l.label) }}
                                            </label>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col-12 mb-2">
                            <select class="form-select" aria-label="–í—ã–±–æ—Ä —á–∞—Å—Ç–∏ —Ä–µ—á–∏" name="${prefix}${type}_m_pos_${current_num}_${ID}" onchange="disableCheckBox(this.value, ${prefix}${type}_m_grammar_${current_num}_${ID})" form="entry" required>
                                <option value="">–Ω–µ –≤—ã–±—Ä–∞–Ω–∞</option>
                                {% for pos in Parts_of_speech.query.all() %}
                                    <option value="{{ pos.pos_id }}">
                                        {{pos.pos_short}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-12">
                            <select class="form-select" multiple aria-label="–ì—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏" name="${prefix}${type}_m_grammar_${current_num}_${ID}" id="${prefix}${type}_m_grammar_${current_num}_${ID}" form="entry">
                                <option value="">–Ω–µ—Ç</option>
                                    {% for l in Label_names.query.filter_by(type=2).order_by(Label_names.rank.asc()).all() %}
                                        <option value="{{ l.label_id }}" pos_ids="{{ l.pos_id }}"
                                        style="font-variant: small-caps">{{ l.label }}</option>
                                    {% endfor %}
                                </select>
                            </select>
                        </div>
                    </div>
                </td>
                <td>
                    <textarea class="form-control" id="${prefix}${type}_m_value_${current_num}_${ID}"
                              name="${prefix}${type}_m_value_${current_num}_${ID}" placeholder="–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ"></textarea>
              </td>
            </tr>`);
            if (type == 'cv') {
                $(`select[name="${prefix}${type}_m_pos_${current_num}_${ID}"] > option[value="1"]`).prop('selected', true);
                $(`select[name="${prefix}${type}_m_pos_${current_num}_${ID}"]`).addClass('d-none');
                disableCheckBox('1', $(`#${prefix}${type}_m_grammar_${current_num}_${ID}`));
            } else if (type == 'i') {
                $(`select[name="${prefix}${type}_m_pos_${current_num}_${ID}"] > option[value=""]`).text('–Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ');
                $(`select[name="${prefix}${type}_m_pos_${current_num}_${ID}"]`).prop('required', false);
            };
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
            for (var i = 0; i < document.getElementsByTagName('textarea').length; ++i) {
            autosize(document.getElementsByTagName('textarea')[i]);
            };
            $(table).find('tbody').children().last().attr("tabindex",-1).focus();
        }

        function addForm(table, unitID, new_unit, gloss='') {
            if (table.rows.length && table.rows.length > 0) {
                var current_num = table.rows.length;
            }
            else {
                var current_num = 1
            }
            var type = unitID.split('/')[0]
            var ID = gloss + unitID.split('/')[1]
            if (new_unit) {
                var prefix = 'new_'
            } else {
                var prefix = 'existent_'
            }
            $(table).find('tbody').append(
                `<tr>
                    <th scope="row">
                        <div class="row row-cols-2 align-items-center justify-content-center g-2">
                            <div class="col-auto">
                                üÜï
                            </div>
                            <div class="col text-center">${current_num}</div>
                        </div>
                    </th>
                    <td>
                        <div class="col-12 col-lg-1 mb-2 mb-lg-0">
                            <div>
                                <a class="text-primary" href="javascript:;" role="button"
                                   id="${prefix}${type}_f_ls_${current_num}_${ID}" data-bs-toggle="dropdown" data-bs-auto-close="outside"
                                   aria-expanded="false" style="text-decoration-line: none; font-variant: small-caps">–ü–æ–º–µ—Ç—ã</a>
                                <ul class="dropdown-menu p-1 overflow-auto" style="height: 35vh" aria-labelledby="dropdownMenuButton">
                                    {% for l in Label_names.query.filter_by(type=1).order_by(Label_names.rank.asc(), Label_names.label.asc()).all() %}
                                        <li>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="{{ l.label_id }}" full_name="{{ l.label }}"
                                                       id="${prefix}${type}_f_l_{{ l.label_id }}_${current_num}_${ID}" name="${prefix}${type}_f_l_{{ l.label_id }}_${current_num}_${ID}"
                                                       onclick="addLabels('${prefix}${type}_f_ls_${current_num}_${ID}', '${prefix}${type}_f_l_{{ l.label_id }}_${current_num}_${ID}')">
                                                <label class="form-check-label" for="${prefix}${type}_f_l_{{ l.label_id }}_${current_num}_${ID}" data-bs-toggle="tooltip"
                                                title="{{ l.decode }}" style="font-variant: small-caps">{{ Markup(l.label) }}</label>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="form-floating mb-2">
                            <input type="text" class="form-control" id="${prefix}${type}_f_fl_${current_num}_${ID}"
                                   name="${prefix}${type}_f_fl_${current_num}_${ID}" placeholder="–ù–æ–≤–∞—è —Ñ–æ—Ä–º–∞">
                            <label for="${prefix}${type}_f_fl_${current_num}_${ID}">–õ–∞—Ç–∏–Ω–∏—Ü–∞</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="${prefix}${type}_f_fc_${current_num}_${ID}" name="${prefix}${type}_f_fc_${current_num}_${ID}"
                                   placeholder="–ù–æ–≤–∞—è —Ñ–æ—Ä–º–∞">
                            <label for="${prefix}${type}_f_fc_${current_num}_${ID}">–ö–∏—Ä–∏–ª–ª–∏—Ü–∞</label>
                        </div>
                    </td>
                </tr>`
);
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });
            $(table).find('tbody').children().last().attr("tabindex",-1).focus();
        }

        function addI_or_CV(table, type) {
            if (table.rows.length && table.rows.length > 0) {
                var current_num = table.rows.length;
            }
            else {
                var current_num = 1;
            }
            var template = document.createElement('tr')
            template.innerHTML = `
            <th scope="row">
                <div class="row row-cols-2 align-items-center justify-content-center g-2">
                    <div class="col-auto">
                        üÜï
                    </div>
                    <div class="col text-center">${current_num}</div>
                </div>
            </th>
            <td class="table-responsive">
                <table class="table table-bordered" id="${type}_new_${current_num}">
                    <thead>
                        <tr>
                            <th scope="col">‚Ññ</th>
                            <th scope="col" style="width: 30%">–ü–æ–º–µ—Ç—ã</th>
                            <th scope="col">–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <button class="btn btn-sm btn-outline-success" id="add_form_${type}_${current_num}"
                        onclick="addForm(${type}_new_${current_num}, '${type}/${type}${current_num}', new_unit=true)" type="button">
                        <span class="text-center">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É</span>
                </button>
            </td>
            <td class="table-responsive">
                <table class="table table-bordered" id="${type}_new_${current_num}_meanings">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 15%">–†–∞–Ω–≥</th>
                            <th scope="col" style="width: 30%">–ü–æ–º–µ—Ç—ã</th>
                            <th scope="col">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <button id="add_meaning_${type}_${current_num}" class="btn btn-sm btn-outline-success"
                        onclick="addMeaning(${type}_new_${current_num}_meanings, '${type}/${type}${current_num}', new_unit=true)" type="button">
                        <span class="text-center">–î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</span>
                </button>
            </td>`
            table.getElementsByTagName("tbody")[0].appendChild(template);
            $(`#add_meaning_${type}_${current_num}`).click();
            $(`#add_form_${type}_${current_num}`).click();
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });
            for (var i = 0; i < document.getElementsByTagName('textarea').length; ++i) {
                autosize(document.getElementsByTagName('textarea')[i]);
            };
            $(table).find('tbody').children().last().attr("tabindex",-1).focus();
        }

        function addNewForm(gloss_id, decode, full_name) {
            if ($(`abbr`).filter(function() {
              return $(this).text() == decode;
            }).length) {
                alert('–¢–∞–∫–∞—è —Ñ–æ—Ä–º–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞!')
                document.getElementById('select_new').selectedIndex = 0;
            }
            else {
                var template = document.createElement('tr')
                template.innerHTML = `
                    <th scope="row">
                        <div class="row row-cols-2 align-items-center justify-content-center g-2">
                            <div class="col-auto">
                                üÜï
                            </div>
                            <div class="col text-center">
                                <abbr style="font-variant-caps: small-caps" data-bs-toggle="tooltip" title="${full_name}">${decode}</abbr>
                            </div>
                        </div>
                    </th>
                    <td class="table-responsive">
                        <table class="table table-bordered" id="form_forms_new_${gloss_id}">
                            <thead>
                                <tr>
                                    <th scope="col">‚Ññ</th>
                                    <th scope="col" style="width: 15%;">–ü–æ–º–µ—Ç—ã</th><th scope="col">–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <button class="btn btn-sm btn-outline-success" id="add_new_form_${gloss_id}_lex" onclick="addForm(form_forms_new_${gloss_id}, 'lex/{{ unit_id }}', new_unit=true, gloss='${gloss_id}_')" type="button">
                            <span class="text-center">–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç —Ñ–æ—Ä–º—ã</span>
                        </button>
                    </td>
                `;
                document.getElementById('unit_forms').getElementsByTagName("tbody")[0].appendChild(template);
                $(`#add_new_form_${gloss_id}_lex`).click();
            }
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        }

        function deleteElement(row, ID, type) {
            $(row).remove();
            $('#entry').append(`<input class="d-none" type="text" name="delete_${type}_${ID}" value="${ID}">`);
        }

        function disableCheckBox(pos_id, grammar) {
            var pos_id = `${pos_id}`;
            $(grammar).children().each(function () {
                if ($(this).attr('pos_ids')) {
                    if ($(this).attr('pos_ids').split(',').includes(pos_id)) {
                        $(this).prop("disabled", false);
                    } else {
                        $(this).prop("disabled", true);
                    }
                }
            });
            grammar.selectedIndex = 0;
        }
        var exampleEl = document.getElementById('delete_lex')
        var popover = new bootstrap.Popover(exampleEl)

        function addLabels(aim, dropdown) {
            if ($(`#${dropdown}`).is(':checked')) {
                const re_ns = RegExp('\n', 'g');
                const re_spaces = RegExp(' +$', 'gm');
                var current_text = $(`#${aim}`).text().replaceAll(re_ns, '').replace(re_spaces, '');
                if (current_text.match('–ü–æ–º–µ—Ç—ã')) {
                    var selected = [$(`#${dropdown}`).attr('full_name')];
                } else {
                    var selected = [current_text, $(`#${dropdown}`).attr('full_name')];
                }
                $(`#${aim}`).text(selected.join(', '));
            } else {
                var label = $(`#${dropdown}`).attr('full_name');
                const re = RegExp(`(,)*( |^)${label}`.replace('\.', '\\\.'), 'g');
                const re_spaces = RegExp('[ \n]+$', 'gm');
                const re_beginning = RegExp('^[ \n]*, ', 'gm');
                var new_text = $(`#${aim}`).text().replace(re, '').replace(re_spaces, '');
                if (new_text == '') {
                    new_text = '–ü–æ–º–µ—Ç—ã'
                }
                new_text = new_text.replace(re_beginning, '')
                $(`#${aim}`).text(new_text)
            }
        };

        function print(what, id) {
            var where = `#${id}`;
            var $txt = jQuery(where);
                var caretPos = $txt[0].selectionStart;
                var textAreaTxt = $txt.val();
                $txt.val(textAreaTxt.substring(0, caretPos) + what + textAreaTxt.substring(caretPos));
            window.setTimeout(function () {
                    $(where).focus();
                    document.getElementById(id).setSelectionRange(7, 12);
                }, 0);
        };

        function new_link() {
            if ($(`#links`).find('> div').length > 0) {
                var current_num = $(`#links`).find('> div').length + 1;
            } else {
                var current_num = 1
            }
            $('#links').append(
            `<div class="col-12 row row-cols-3 align-items-center justify-content-start g-2 pb-1" id="link_${current_num}">
                <div class="col-auto" onclick="$('#link_${current_num}').remove()" style="cursor: pointer;">
                    ‚ùå
                </div>
                <div class="col-auto">
                    <input class="form-control form-control-sm" type="number" placeholder="–†–∞–Ω–≥" maxlength="20" name="link_rank_${current_num}" form="entry">
                </div>
                <div class="col-auto">
                    <input class="form-control form-control-sm" type="number" placeholder="ID" maxlength="20" name="link_id_${current_num}" form="entry" onchange="preview(this);" current_num="${current_num}">
                </div>
                <div class="col-auto">
                    <select class="form-select form-select-sm" type="number" name="link_type_${current_num}" form="entry">
                        <option value="1">—Å–º. —Ç–∞–∫–∂–µ</option>
                        <option value="2">—Å–∏–Ω–æ–Ω–∏–º</option>
                        <option value="3">–∞–Ω—Ç–æ–Ω–∏–º</option>
                        <option value="4">–æ–º–æ–Ω–∏–º</option>
                        <option value="5">–¥–µ—Ä–∏–≤–∞—Ç</option>
                        <option value="6">–∫–æ–≥–Ω–∞—Ç</option>
                        <option value="7">–≥–∏–ø–µ—Ä–æ–Ω–∏–º</option>
                        <option value="8">–≥–∏–ø–æ–Ω–∏–º</option>
                        <option value="9">–∫–æ–≥–∏–ø–æ–Ω–∏–º</option>
                        <option value="10">–∫–æ–Ω–≤–µ—Ä—Å–∏–≤</option>
                    </select>
                </div>
                <div class="col-auto">
                    <div class="text-secondary" id="preview_${current_num}"></div>
                </div>
             </div>
            `
            );
            $('#links').children().last().attr("tabindex",-1).focus();
        };

        function preview(ID) {
            var packet = {
                type: 'preview_entry',
                input: $(ID).val()
            };
            fetch('{{ url_for('autocomplete') }}', {
                method: 'POST',
                credentials: 'include',
                body: JSON.stringify(packet),
                cache: 'no-cache',
                headers: new Headers({
                    'content-type': 'application/json'
                })
            })
            .then(function (response) {
                if (response.status == 200) {
                    response.json().then(function (items) {
                            $(`#preview_${$(ID).attr('current_num')}`).html(items);
                        }
                    )
                }
            });
        }
    </script>
{% endblock %}